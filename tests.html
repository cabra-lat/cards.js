<!DOCTYPE html>
<html>
  <head>
    <title>cards.js - Write card games in Javascript</title>
    <script type="module" src="cards.js"></script>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
<script>
    hljs.configure({ cssSelector: 'code' })
    hljs.highlightAll();
</script>
  </head>

  <script type="module">
    import { CardsJS } from './cards.js'

    class Example {
      constructor() {
        this.codes = Array.from(document.querySelectorAll('code[id^="ex"]'))
        this.table = document.getElementById('card-table')
        this.label = document.getElementById('code-label')
        this.console = document.getElementById('console')
        this.examples = this.codes.length
        this.prevButton = document.getElementById('prev')
        this.nextButton = document.getElementById('next')
        this.resetButton = document.getElementById('reset')
        this.prevButton.addEventListener('click', this.prev)
        this.nextButton.addEventListener('click', this.next)

        this.stateReset()
        this.execute()

        this.resetButton.addEventListener('click', () => {
           this.table.replaceChildren();
           this.stateReset()
           this.execute()
        })
      }

      stateReset = () => {
         this.variables = {}
         this.counter = 0
         this.maxSeen = 0
         this.ended = false
      }

      stateChange = () => {
        // Update button states
        this.prevButton.disabled = this.counter <= 0
        this.nextButton.disabled = this.counter === this.examples - 1
        if (this.nextButton.disabled) this.ended = true
        this.resetButton.disabled = this.counter === 0

        // Show the current code block
        this.codes.forEach((code) => code.classList.remove('visible'))
        this.codes[this.counter].classList.add('visible')
        if (this.console.innerText === '')
          this.console.classList.remove('visible')
      }

      next = () => {
        this.counter++
        this.maxSeen = Math.max(this.counter, this.maxSeen)
        if (!this.ended && this.counter >= this.maxSeen)
          this.execute()
        this.stateChange()
        this.console.innerText === ''
      }

      prev = () => {
        this.counter--
        this.stateChange()
      }

      execute = async () => {
        let code = this.codes[this.counter].innerText;

        // Find all declared variables
        const matches = code.matchAll(/let (\w+)/gm);
        for (const match of matches) {
          this.variables[match[1]] = null; // Initialize variables in the scope
        }

        // Replace "let" variables with this.variableName to scope them
        Object.keys(this.variables).forEach((varName) => {
          code = code.replaceAll('let ', '')
          code = code.replaceAll(`${varName}`, `this.variables.${varName}`)
        })

        let alert = (string) => {
           this.label.innerHTML = string.replaceAll(/this\.variables\./gm,'')
        }

        let show = (string) => {
           if (string) {
             this.console.innerHTML = string.toString()
                                            .replaceAll(/this\.variables\./gm,'')
             this.console.classList.add('visible')
           }
        }

        try {
          // Evaluate the code within the class context
          eval(code)
          this.stateChange()
        } catch (err) {
          show('Error executing code: ' + err.message + '\n' + err.stack);
          console.log(code.toString())
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const example = new Example()
    });
  </script>
  <header>
  <h1>Cards.js</h1>
  <h3>The easiest way to write card games in Javascript</h3>
  <p>
    cards.js is a library to write good-looking card games in Javascript. It's not a framework;
    it focuses on rendering playing cards, animating them, and providing a simple interface for use in your games.
  </p>
  </header>

  <h3 id="code-label"></h3>

  <!-- Example Code Blocks and Card Table aligned side by side -->
  <div class="container">

    <div class="code-container">

    <div id="card-table">
    </div>

    <div id="buttons">
      <button id="prev" disabled>Previous</button>
      <button id="reset" disabled>Reset</button>
      <button id="next" disabled>Next</button>
    </div>

    </div>

    <div class="code-container">

<code id="ex1" class="visible language-javascript">
// Let's design a game based on Crazy 8's
let config = {
  // 13 cards, plus 2 wildcards
  ranks: CardsJS.generateRanks(13 + 2),
  // The suits are colors
  suits: ['R', 'G', 'B', 'Y'],
  ranksOrder: CardsJS.acesHigh,
  // Custom artwork
  cardsUrl: 'img/cards_custom.png'
}
</code>

<code id="ex1" class="visible language-javascript">
// Initialize the library and create a new deck
let cards = new CardsJS({ copies: 16, table: '#card-table', ...config });
let deck = cards.Deck({ seenFrom: 'above' })
deck.addCards(cards.all);
deck.render({ immediate: true });
</code>

<code id="ex0" class="visible language-javascript">
// Initialize the library and create a new deck
let cards = new CardsJS({ table: '#card-table', ...config });
let labels = ['left', 'top', 'bottom', 'right']
let povs = Object.keys(CardsJS.perspective)

let players = labels.reduce((acc, label, i) => {
  return [...acc, ...povs.map((side, j) => {
    const W = cards.cardWidth
    const H = cards.cardHeight 
    return cards.Deck({
      x: i * (W + W) + W / 2,
      y: j * (H + H) + H / 2,
      label: label + ', ' + side, 
      seenFrom: side, sticky: label
    })
  })]
}, [])

console.log(players)

deck.deal(-1, players, 10)
</code>

<code id="ex13" class="language-javascript">
const r = 150     // radius
const cx = cards.center.x // center X
const cy = cards.center.y // center Y
let others = ['Alice','Bob','Charlie']
let players = ['You', ...others]
let layout = CardsJS.circularLayout(players, cx, cy, r)
let hands = layout.map(
({ x, y },i) => cards.Deck({
    x, y,
    faceUp: i === 0,
    label: names[i],
    sticky: 
    direction: 'northEast'
  })
)
alert("Dealing cards...")
deck.deal(-1, players, 100,
  () => alert("Dealt cards to players!")
)
</code>

<code id="console" class="visible no-highlight"></code>

    </div>
  </div>
</body>
