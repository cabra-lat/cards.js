<!DOCTYPE html>
<html>
  <head>
    <title>cards.js - Write card games in Javascript</title>
    <script type="module" src="cards.js"></script>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
<script>
    hljs.configure({ cssSelector: 'code' })
    hljs.highlightAll();
</script>
  </head>

  <script type="module">
    import { CardsJS } from './cards.js'

    class Example {
      constructor() {
        this.codes = Array.from(document.querySelectorAll('code[id^="ex"]'))
        this.table = document.getElementById('card-table')
        this.label = document.getElementById('code-label')
        this.console = document.getElementById('console')
        this.examples = this.codes.length
        this.prevButton = document.getElementById('prev')
        this.nextButton = document.getElementById('next')
        this.resetButton = document.getElementById('reset')
        this.prevButton.addEventListener('click', this.prev)
        this.nextButton.addEventListener('click', this.next)

        this.stateReset()
        this.execute()

        this.resetButton.addEventListener('click', () => {
           this.table.replaceChildren();
           this.stateReset()
           this.execute()
        })
      }

      stateReset = () => {
         this.variables = {}
         this.counter = 0
         this.maxSeen = 0
         this.ended = false
      }

      stateChange = () => {
        // Update button states
        this.prevButton.disabled = this.counter <= 0
        this.nextButton.disabled = this.counter === this.examples - 1
        if (this.nextButton.disabled) this.ended = true
        this.resetButton.disabled = this.counter === 0

        // Show the current code block
        this.codes.forEach((code) => code.classList.remove('visible'))
        this.codes[this.counter].classList.add('visible')
        if (this.console.innerText === '')
          this.console.classList.remove('visible')
      }

      next = () => {
        this.counter++
        this.maxSeen = Math.max(this.counter, this.maxSeen)
        if (!this.ended && this.counter >= this.maxSeen)
          this.execute()
        this.stateChange()
        this.console.innerText === ''
      }

      prev = () => {
        this.counter--
        this.stateChange()
      }

      execute = async () => {
        let code = this.codes[this.counter].innerText;

        // Find all declared variables
        const matches = code.matchAll(/let (\w+)/gm);
        for (const match of matches) {
          this.variables[match[1]] = null; // Initialize variables in the scope
        }

        // Replace "let" variables with this.variableName to scope them
        Object.keys(this.variables).forEach((varName) => {
          code = code.replaceAll('let ', '')
          code = code.replaceAll(`${varName}`, `this.variables.${varName}`)
        })

        let alert = (string) => {
           this.label.innerHTML = string.replaceAll(/this\.variables\./gm,'')
        }

        let show = (string) => {
           if (string) {
             this.console.innerHTML = string.toString()
                                            .replaceAll(/this\.variables\./gm,'')
             this.console.classList.add('visible')
           }
        }

        try {
          // Evaluate the code within the class context
          eval(code)
          this.stateChange()
        } catch (err) {
          show('Error executing code: ' + err.message + '\n' + err.stack);
          console.log(code.toString())
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const example = new Example()
    });
  </script>
  <header>
  <h1>Cards.js</h1>
  <h3>The easiest way to write card games in Javascript</h3>
  <p>
    cards.js is a library to write good-looking card games in Javascript. It's not a framework;
    it focuses on rendering playing cards, animating them, and providing a simple interface for use in your games.
  </p>
  </header>

  <!-- Navigation Buttons -->
  <div id="buttons">
    <button id="prev" disabled>Previous</button>
    <button id="reset" disabled>Reset</button>
    <button id="next" disabled>Next</button>
  </div>

    <h3 id="code-label"></h3>

  <!-- Example Code Blocks and Card Table aligned side by side -->
  <div class="container">

    <div id="card-table">
    </div>
    <div class="code-container">

<code id="ex1" class="visible language-javascript">
// Let's design a game based on Crazy 8's
let config = {
  // 13 cards, plus 2 wildcards
  ranks: CardsJS.generateRanks(13 + 2),
  // The suits are colors
  suits: ['R', 'G', 'B', 'Y'],
  ranksOrder: CardsJS.acesHigh,
  // Custom artwork
  cardsUrl: 'img/cards_custom.png'
}
</code>

<code id="ex1" class="visible language-javascript">
// Initialize the library and create a new deck
let cards = new CardsJS({ table: '#card-table', ...config });
let deck = cards.Deck();
// Add all cards to the deck
deck.addCards(cards.all);
// Render deck on the table
deck.render({ immediate: true });
</code>

<code id="ex2" class="language-javascript">
// Create two hands, one face-down...
let upper = cards.Deck({
  y: 50,
  type: 'hand'
});
//... and one face-up!
let lower = cards.Deck({
  y: 350,
  faceUp: true,
  type: 'hand'
});
// Deal 5 cards to each hand
deck.deal(5, [upper, lower], 50);
alert('Created two hands!');
</code>

<code id="ex3" class="language-javascript">
// Setup a click handler to draw cards from the deck
deck.click((card) => {
  if (card === deck.topCard()) {
    lower.addCard(deck.topCard());
    lower.render();
  }
});
alert('Try clicking the deck now!');
</code>

<code id="ex4" class="language-javascript">
// Move the deck and set up a discard pile
deck.x -= 50;
deck.render();
let pile = cards.Deck({ faceUp: true });
pile.x += 50;
deck.render({
  callback: () => {
    pile.addCard(deck.topCard());
    pile.render();
  },
});
</code>

<code id="ex5" class="language-javascript">
// Allow sending cards to the discard pile
lower.click((card) => {
  const top = pile.topCard()
  if (!top) {
    deck.addCard(card)
  } else {
    if (card.suit === top.suit ||
        card.rank === top.rank ||
        card.rank > 13 ) {
      pile.addCard(card);
    }
  }
  deck.render()
  pile.render()
});
</code>

<code id="ex6" class="language-javascript">
// Flip the deck face-up
deck.faceUp = true;
deck.render();
alert('Deck flipped face-up!');
</code>

<code id="ex7" class="language-javascript">
// Get cards back to main deck
const speed = 200;
upper.deal(-1, [deck], speed, () => {
  alert("Upper returned its cards")
  lower.deal(-1, [deck], speed, () => {
    alert("Lower returned its cards")
    pile.deal(-1, [deck], speed, () => {
      alert("Returned all cards!")
    })
  })
})
</code>

<code id="ex8" class="language-javascript">
// Shuffle the deck
deck.shuffle();
alert('Deck shuffled!');
</code>

<code id="ex9" class="language-javascript">
// Sort the deck
deck.shuffle()
    .sort(CardsJS.compareBySuit); // by suit
alert('Deck sorted by suit!');
</code>

<code id="ex10" class="language-javascript">
// Sort the deck
deck.shuffle()
    .sort(CardsJS.compareByRank);
alert('Deck sorted by rank!');
</code>

<code id="ex11" class="language-javascript">
// Sort the deck
deck.shuffle()
    .sort(CardsJS.compareBySuitThenRank);
alert('Deck sorted by suit, then rank!');
</code>

<code id="ex12" class="language-javascript">
// Sort the deck
deck.shuffle()
    .sort(CardsJS.compareByRankThenSuit);
alert('Deck sorted by rank, then suit!');
</code>

<code id="ex13" class="language-javascript">
const r = 150     // radius
const cx = cards.center.x // center X
const cy = cards.center.y // center Y
let names = ['You','Alice','Bob','Charlie']
let layout = CardsJS.circularLayout(names, cx, cy, r)
let players = layout.map(
({ x, y },i) => cards.Deck({
    x, y,
    faceUp: i === 0,
    label: names[i]
  })
)
alert("Dealing cards...")
deck.deal(-1, players, 100,
  () => alert("Dealt cards to players!")
)
</code>

<code id="console" class="visible no-highlight"></code>

    </div>
  </div>
</body>
